<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>Intro to layers | Sample | ArcGIS Maps SDK for JavaScript</title>

    <!-- Load Calcite components from CDN -->
    <script
      type="module"
      src="https://js.arcgis.com/calcite-components/3.3.3/calcite.esm.js"
    ></script>

    <!-- Load the ArcGIS Maps SDK for JavaScript from CDN -->
    <script src="https://js.arcgis.com/4.34/"></script>

    <!-- Load Map components from CDN-->
    <script
      type="module"
      src="https://js.arcgis.com/4.34/map-components/"
    ></script>

    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }
    </style>
  </head>

  <body>
    <arcgis-map item-id="eb3dcfc233bb4d95b79533b5eda03c14">
      <!-- basemap="dark-gray" center="8.677242939823607, 50.10735208625505" zoom="5"> -->
      <arcgis-zoom slot="top-left"></arcgis-zoom>
      <arcgis-layer-list slot="top-right"></arcgis-layer-list>
      <arcgis-legend slot="bottom-left"></arcgis-legend>
    </arcgis-map>

    <script type="module">
      // Import Map, FeatureLayer, and PopupTemplate classes from the CDN.
      const [Map, FeatureLayer, PopupTemplate] = await $arcgis.import([
        "@arcgis/core/Map.js",
        "@arcgis/core/layers/FeatureLayer.js",
        "@arcgis/core/PopupTemplate.js",
      ]);

      // Get reference to map
      const viewElement = document.querySelector("arcgis-map");
      // Wait for the map to be ready before adding anything
      await viewElement.viewOnReady();
      const map = viewElement.map;

      // Create a renderer
      const renderer = {
        type: "simple", // SimpleRenderer()
        //
        //Apply arrow symbology
        //
        symbol: {
          type: "simple-marker", // SimpleMarkerSymbol()
          // Arrow marker
          path: "M14.5,29 23.5,0 14.5,9 5.5,0z",
          color: [150, 150, 150],
          outline: {
            color: [0, 0, 0, 0.15],
            width: "1px",
          },
          angle: 180,
          size: 15,
        },
        visualVariables: [],
      };

      //
      // 3 visual variables:
      //

      // Define rotation variable - indicates wind direction
      const visVarWindDir = {
        type: "rotation",
        field: "WIND_DIRECT",
        rotationType: "geographic",
      };
      // renderer.visualVariables.push(visVarWindDir)

      // Define size variable - indicates wind speed
      const visVarWindSpeed = {
        type: "size",
        field: "WIND_SPEED",
        stops: [
          {
            value: 0,
            size: 4,
          },
          {
            value: 20,
            size: 12,
          },
          {
            value: 60,
            size: 40,
          },
        ],
      };
      // renderer.visualVariables.push(visVarWindSpeed)

      // Define color variable - indicates air temperature in °F
      const visVarTempF = {
        type: "color",
        field: "TEMP",
        stops: [
          {
            value: 20,
            color: "#2b83ba",
          },
          {
            value: 35,
            color: "#abdda4",
          },
          {
            value: 50,
            color: "#ffffbf",
          },
          {
            value: 65,
            color: "#fdae61",
          },
          {
            value: 80,
            color: "#d7191c",
          },
        ],
      };
      //renderer.visualVariables.push(visVarTempF)

      // Define color variable - indicates air temperature in °C
      const celsiusArcade = document.getElementById(
        "fahrenheit-to-celsius"
      ).text;
      const visVarTempC = {
        type: "color",
        valueExpression: celsiusArcade,
        valueExpressionTitle: "Air Temperature (°C)",
        stops: [
          {
            value: -10,
            color: "#2b83ba",
          },
          {
            value: 0,
            color: "#abdda4",
          },
          {
            value: 10,
            color: "#ffffbf",
          },
          {
            value: 20,
            color: "#fdae61",
          },
          {
            value: 30,
            color: "#d7191c",
          },
        ],
      };
      // renderer.visualVariables.push(visVarTempC)

      //
      // Set the renderer on the feature layer
      //
      const layer = new FeatureLayer({
        portalItem: {
          id: "cb1886ff0a9d4156ba4d2fadd7e8a139",
        },
        title: "Current weather conditions",
        renderer: renderer,
      });
      view.map.add(layer);
      view.ui.add(
        new Legend({
          view: view,
        }),
        "bottom-right"
      );
    </script>
  </body>
</html>
